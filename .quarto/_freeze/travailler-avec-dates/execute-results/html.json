{
  "hash": "73d09dbdac70a31eea284414c3184fbe",
  "result": {
    "markdown": "# Travailler avec les dates\n\nNous allons apprendre maintenant à travailler avec des dates. R dispose des package facilitant la manipulation des dates. Le plus utilisé est sans doute `lubridate`.\n\nLe package `lubridate` est une collection de fonctions pour manipuler des dates en R. Il a été développé pour simplifier le processus de transformation de dates dans le format le plus approprié pour l'analyse de données. Le package permet de facilement extraire des composantes de dates (jour, mois, année), de calculer des différences de temps entre deux dates et de convertir des dates dans différents formats.\n\nNous utiliserons la table de données `flights` contenu dans le package `nycflights13`.\n\n\n\n\n\n## Créer une variable date\n\nIl y a trois types de données qui font référence à un instant dans le temps :\n\n-   date, affiché comme `<date>` dans tibble\n\n-   time, affiché comme `<time>` dans tibble\n\n-   date-time, affiché comme `<dttm>` dans tibble\n\nOn peut obtenir la date actuelle avec `today()` et `now()` :\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntoday()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-06-13\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnow()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-06-13 11:28:11 WAT\"\n```\n:::\n:::\n\n\nUne variable date peut être créée à partir d'une chaîne de caractère, des composants individuels de date ou d'une autre variable date.\n\n### A partir d'une chaîne de caractère {.unnumbered}\n\nIl y a trois fonctions qui permettent de créer d'une variable date à partir d'une chaîne de caractère. Leur nom varie selon l'ordre du jour, mois et année dans la chaîne de caractère. Il s'agit de `dmy()`, `mdy()` et `ymd()`, où d, m et y représentent respectivement le jour, le mois et l'année.\n\nUn exemple est donné ci-après :\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndmy(\"21-08-2023\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-08-21\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nymd(\"2020-Feb-12\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2020-02-12\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmdy(\"July 1, 2017\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2017-07-01\"\n```\n:::\n:::\n\n\nPour créer une date associé au temps, il suffit d'ajouter `hms` ou `hm` où h, m et s représentent respectivement l'heure, la minute et la seconde.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndmy_hms(\"21-08-2023 10-10-25\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-08-21 10:10:25 UTC\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmdy_hm(\"July 1, 2017 16-10\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2017-07-01 16:10:00 UTC\"\n```\n:::\n:::\n\n\nDans la pratique, on passe généralement à ces fonctions une variable contenant la chaîne de caractère qu'on souhaitre transformer en date.\n\n### A partir de composants individuels de date {.unnumbered}\n\nAu lieu d'une seule chaîne de caractère, vous aurez parfois des composants de date dans plusieurs colonnes. C'est ce que nous avons dans ces données.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights %>%\nselect(year, month, day, hour, minute)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 336,776 × 5\n    year month   day  hour minute\n   <int> <int> <int> <dbl>  <dbl>\n 1  2013     1     1     5     15\n 2  2013     1     1     5     29\n 3  2013     1     1     5     40\n 4  2013     1     1     5     45\n 5  2013     1     1     6      0\n 6  2013     1     1     5     58\n 7  2013     1     1     6      0\n 8  2013     1     1     6      0\n 9  2013     1     1     6      0\n10  2013     1     1     6      0\n# … with 336,766 more rows\n```\n:::\n:::\n\n\nUtilisez `make_date()` pour créer une variable date et `make_datetime()` pour date-time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights %>% \n  select(year, month, day, hour, minute) %>% \n  mutate(\n    depart = make_datetime(year, month, day, hour, minute)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 336,776 × 6\n    year month   day  hour minute depart             \n   <int> <int> <int> <dbl>  <dbl> <dttm>             \n 1  2013     1     1     5     15 2013-01-01 05:15:00\n 2  2013     1     1     5     29 2013-01-01 05:29:00\n 3  2013     1     1     5     40 2013-01-01 05:40:00\n 4  2013     1     1     5     45 2013-01-01 05:45:00\n 5  2013     1     1     6      0 2013-01-01 06:00:00\n 6  2013     1     1     5     58 2013-01-01 05:58:00\n 7  2013     1     1     6      0 2013-01-01 06:00:00\n 8  2013     1     1     6      0 2013-01-01 06:00:00\n 9  2013     1     1     6      0 2013-01-01 06:00:00\n10  2013     1     1     6      0 2013-01-01 06:00:00\n# … with 336,766 more rows\n```\n:::\n:::\n\n\n### A partir d'une autre variable date {.unnumbered}\n\nVous pouvez quitter d'un type date à un type date-time ou vice-versa. Deux fonctions permettent d'acomplir cela. Il s'agit de `as_datetime()` et `as_date()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas_datetime(today())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-06-13 UTC\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nas_date(now())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"2023-06-13\"\n```\n:::\n:::\n\n\n## Extraire les composants de date\n\nIl est possible de d'extraire des composants de date comme l'année (`year()`), le mois (`month()`), le jour du mois (`mday()`), le jour de l'année (`yday()`), le jour de la semaine (`wday()`), l'heure (`hour()`), la minute et la seconde `second()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndatetime <- dmy_hms(\"15-02-2023 14:25:02\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyear(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2023\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmonth(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyday(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 46\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmday(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 15\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwday(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhour(datetime)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 14\n```\n:::\n:::\n\n\n`month()` et `wday()` dispose de `label =` et `abbr =`. `label = TRUE` permet d'obtenir des noms abbrégés de mois ou de jour au lieu de nombre, et `abbr = FALSE` permet d'obtenir les noms complets au lieu des abbrégés.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmonth(datetime, label = T, abbr = F)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] février\n12 Levels: janvier < février < mars < avril < mai < juin < juillet < ... < décembre\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwday(datetime, label = T, abbr = F)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] mercredi\n7 Levels: dimanche < lundi < mardi < mercredi < jeudi < ... < samedi\n```\n:::\n:::\n\n\n## Calculer la durée entre deux dates\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage <- today() - dmy(\"25-05-1999\")\nage\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime difference of 8785 days\n```\n:::\n\n```{.r .cell-code}\nclass(age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"difftime\"\n```\n:::\n:::\n\n\nQuand vous effectuez ce calcul, vous obtenez un objet de type `difftime`. Le problème avec `difftime` est qu'il donne le résulat avec différentes unités (seconde, minutes, ...). Pour résoudre ce problème, vous pouvez utiliser la fonction `as.duration()` pour convertir la valeur en seconde. Et pour pouvoir effectuer des calculs, vous pouvez convertir le résultat de `as.duration()` en numérique avec la fonction `as.numeric()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nas.duration(age)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"759024000s (~24.05 years)\"\n```\n:::\n\n```{.r .cell-code}\nas.numeric(as.duration(age))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 759024000\n```\n:::\n:::\n\n\nVous pouvez alors convertir cette valeur en n'importe quelle unité en considérant q'une minute correspond à 60 secondes.\n",
    "supporting": [
      "travailler-avec-dates_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}